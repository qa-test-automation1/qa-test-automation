name: "Alerte Priorit√© Critique v3"

on:
  issues:
    types: [opened, labeled]

jobs:
  gestion-priorite:
    if: github.event.label.name == 'Critical' || contains(github.event.issue.labels.*.name, 'Critical')
    runs-on: ubuntu-latest
    
    permissions:
      issues: write
      repository-projects: write

    steps:
      - name: 1. Assigner et Commenter
        uses: actions/github-script@v7
        with:
          script: |
            // Assigne l'utilisateur (Toi)
            await github.rest.issues.addAssignees({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              assignees: [context.repo.owner]
            });
            // Message d'alerte
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: "üö® **Alerte :** Ticket Critique d√©tect√©. Assignation faite. (Note: Si le mouvement √©choue, v√©rifiez les acc√®s au projet)."
            });

      - name: 2. Ajouter au Projet et d√©placer
        uses: actions/add-to-project@v1.0.1
        with:
          project-url: https://github.com/users/Ghazi-Kriaa/projects/4
          github-token: ${{ secrets.GITHUB_TOKEN }}
