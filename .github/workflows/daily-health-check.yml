name: Daily Regression Health Check

on:
  schedule:
    - cron: "0 7 * * *"
  workflow_dispatch:

jobs:
  daily-regression:
    runs-on: ubuntu-latest

    permissions:
      issues: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run Critical Tests
        id: tests
        run: |
          echo "Running regression tests..."
          sleep 5
          echo "All critical tests passed"

      - name: Create Success Issue
        if: success()
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: "ðŸŸ¢ Daily Health Check - OK",
              body: "Tous les tests critiques sont passÃ©s avec succÃ¨s ce matin.",
              labels: ["health-check"]
            });

      - name: Create Failure Alert
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: "ðŸ”´ Daily Health Check - FAILED",
              body: "Les tests critiques ont Ã©chouÃ©. Intervention QA requise.",
              labels: ["Critical"]
            });
